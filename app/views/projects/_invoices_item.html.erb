<style>
  .table > tbody > tr > td{
    padding: 2px;
  }
</style>
  <i class="fa fa-shopping-cart bg-orange"></i>

  <div class="timeline-item">
    <div class="timeline-body" id="invoice_timeline">
      <div class="box box-default collapsed-box" style="margin-bottom: 5px;">
        <div class="box-header with-border">
          <h4 class="box-title">
            <% if can? :new, :invoices %>
            <%= link_to '开票申请', new_invoice_path(@project), 'data-toggle' => "modal", 'data-target' => "#global-modal", class: 'btn'  if @project.can_do? :invoice %>
            <%end %>
          </h4>

          <div class="box-tools pull-right">
<!--            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>-->
<!--            </button>-->
          </div>
          <!-- /.box-tools -->
        </div>
        <!-- /.box-header -->

        <div class="box-body" style="display: none;border: solid 1px #d2d6de;" >


        </div>

      </div>
  <% @project.invoices.each do |invoice| %>
      <div class="box box-default collapsed-box" style="margin-bottom: 5px;">
        <div class="box-header with-border">
          <h4 class="box-title">票号<%= invoice.invoice_no %>
            <% if can? :edit, :invoices %>
            <%= link_to '编辑', edit_invoice_path(@project, invoice_id: invoice.id), 'data-toggle' => "modal", 'data-target' => "#global-modal", class: 'btn' if invoice.can_edit? %>
            <% end %>
          </h4>

          <div class="box-tools pull-right">
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
            </button>
          </div>
          <!-- /.box-tools -->
        </div>
        <!-- /.box-header -->
          <div class="box-body" style="display: none;border: solid 1px #d2d6de; word-wrap:break-word; overflow-x: scroll">


            <% invoice.orders.each do |order| %>
              <div class="col-md-4">
                <!-- Profile Image -->
                <div class="box-primary">
                  <div class="box-body box-profile">
                    <p class="text-muted text-center"><%= order.no %></p>

                    <ul class="list-group list-group-unbordered">
                      <% order.order_products.each do |order_product| %>
                        <li class="list-group-item">
                          <p><b><%= order_product.product&.name  %> * <a><%= order_product.number  %></a></b> <span style="text-align: right"><a class="pull-right"><%= order_product.real_total_price %></a></span></p>
                        </li>
                      <% end %>

                      <li class="list-group-item">
                        <b>商品总价格 </b> <a class="pull-right"><%= order.real_total_price %></a>
                      </li>
                    </ul>
                  </div>
                  <!-- /.box-body -->
                </div>
                <!-- /.box -->
              </div>
            <% end %>
          </div>

        <!-- /.box-body -->
      </div>
  <% end %>
      <div style="text-align: right">
        <% if can? :step_event, :projects %>
        <%= link_to '下一步', 'JavaScript:void(0)', onclick: "step_event('done_invoice')",class: 'btn  btn-success btn-sm' if @project.can_do? :invoice %>
        <%end %>
      </div>
    </div>
  </div>