<style>
  .table > tbody > tr > td{
    padding: 2px;
  }
</style>
  <i class="fa fa-shopping-cart bg-orange"></i>

  <div class="timeline-item">
    <div class="timeline-body" id="invoice_timeline">
      <div class="box box-default collapsed-box" style="margin-bottom: 5px;">
        <div class="box-header with-border">
          <h4 class="box-title" style="font-size: 16px;">
            <% if can? :new, :invoices %>
            <%= link_to '开票申请', new_invoice_path(@project), 'data-toggle' => "modal", 'data-target' => "#global-modal", class: 'btn'  if @project.can_do? :invoice %>
            <%end %>
          </h4>

          <div class="box-tools pull-right">
<!--            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>-->
<!--            </button>-->
          </div>
          <!-- /.box-tools -->
        </div>
        <!-- /.box-header -->

        <div class="box-body" style="display: none;border: solid 1px #d2d6de;" >


        </div>

      </div>
  <% @project.invoices.each do |invoice| %>
      <div class="box box-default collapsed-box" style="margin-bottom: 5px;">
        <div class="box-header with-border">
          <h4 class="box-title">票号<%= invoice.invoice_no %>
            <% if can?(:edit, :invoices) && invoice.can_edit? %>
            <%= link_to '编辑', edit_invoice_path(@project, invoice_id: invoice.id), 'data-toggle' => "modal", 'data-target' => "#global-modal", class: 'btn' if invoice.can_edit? %>
            <% end %>
          </h4>

          <div class="box-tools pull-right">
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
            </button>
          </div>
          <!-- /.box-tools -->
        </div>
        <!-- /.box-header -->
          <div class="box-body" style="display: none;border: solid 1px #d2d6de; word-wrap:break-word; overflow-x: scroll">
            <%= render partial: 'invoices/detail', locals: {invoice: invoice} %>
            <div class="col-md-12">
              <div class="col-md-6" style="text-align: left">
                <b>状态：</b><%= invoice.get_status %>
                <% if invoice.failed? %><span style="color: red"><%= invoice.audit_failed_reason %></span>
                <% end %>
              </div>
              <div class="col-md-6">
                <b>合计：</b><%= invoice.total_price %>
                <span style="text-align: right; float: right">
                <% if can? :invoice_apply, :invoices %>
                    <%= link_to '申请', 'JavaScript:void(0)', onclick: "apply_invoice(#{invoice.id})",class: 'btn btn-success btn-xs' if @project.can_do?(:invoice) && invoice.may_do_apply? %>
                    <%end %>
                </span>
              </div>
            </div>
          </div>

        <!-- /.box-body -->
      </div>
  <% end %>
      <div style="text-align: right">
        <% if can? :step_event, :projects %>
        <%= link_to '下一步', 'JavaScript:void(0)', onclick: "step_event('done_invoice')",class: 'btn  btn-success btn-sm' if @project.can_do? :invoice %>
        <%end %>
      </div>
    </div>
  </div>